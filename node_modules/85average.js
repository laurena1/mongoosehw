var mongoose = require('mongoose');

var connString = "mongodb://" + process.env.IP + ":27017/";
var dbName = "studentsdb";

//connect
var db = mongoose.connect(connString + dbName);

//get the schema - notice how we use the export
var studentSchema = require('./mongoose_word_schema.js').studentSchema;

//make the model - assocated it with the schema
var Students = mongoose.model('Students', studentSchema);

//for disonnecting
setTimeout(function() {
    mongoose.disconnect();
}, 3000);


mongoose.connection.once('open', function() {
    
    //notice how the query is created using method chaining or "piping"
    var query = Students.find();
    query.exec(function(err, docs) {
        
        for(var i in docs)
        {
            
            if(docs[i].average() > 85) {
                console.log(docs[i].first + " " + docs[i].last);
                console.log(docs[i].average());
            }
        } 
            
    });
});
