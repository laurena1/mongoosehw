var mongoose = require('mongoose');

var connString = "mongodb://" + process.env.IP + ":27017/";
var dbName = "studentsdb";


var db = mongoose.connect(connString + dbName);

var studentSchema = require('./mongoose_word_schema.js').studentSchema;


var Students = mongoose.model('Students', studentSchema);

setTimeout(function() {
    mongoose.disconnect();
}, 3000);


mongoose.connection.once('open', function() {
    
    
    Students.find( {},function(err, docs) {
        var badGrades = [];
        
        for(var i in docs)
        {
            if(docs[i].average() < 70) {
                badGrades[badGrades.length] = docs[i].first;
                
            }
        } 
            var query = Students.remove();
            query.in('first', badGrades)
            query.exec(function(err, results)
            {
                console.log("This is how many students were deleted: " + results);
            });
    });
});
