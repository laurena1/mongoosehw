//bring in the module
var mongoose = require('mongoose');

var connString = "mongodb://" + process.env.IP + ":27017/";
var dbName = "studentsdb";

//connect
var db = mongoose.connect(connString + dbName);

//get the schema - notice how we use the export
var studentSchema = require('./mongoose_word_schema.js').studentSchema;

var Students = mongoose.model('Students', studentSchema);

//again, once is the event-handling "hook" for when the database is opened
mongoose.connection.once('open', function() {
    
   

    var query = Students.find();
    query.exec(function(err, docs) {
        var lastNameLength = 0;
        var longestLastName = 0;
        var maxGrade = 0;
        for(var i=0; i < docs.length; i++)
        {
            if(docs[i].last.length > lastNameLength){
                lastNameLength = docs[i].last.length;
                longestLastName = docs[i].last;
                maxGrade = Math.max(docs[i].grades.homework1, docs[i].grades.homework2, 
                docs[i].grades.homework3);
                 
            }   
        }

        console.log("The longest last name is: " +  longestLastName);
        console.log("The students highest grade is: " + maxGrade);
        console.log("The students highest grade with 10 points added: " + (maxGrade + 10));

        });
});