//bring in the module
var mongoose = require('mongoose');

var connString = "mongodb://" + process.env.IP + ":27017/";
var dbName = "studentsdb";

//connect
var db = mongoose.connect(connString + dbName);

//get the schema - notice how we use the export
var studentSchema = require('./mongoose_word_schema.js').studentSchema;

var Students = mongoose.model('Students', studentSchema);

//again, once is the event-handling "hook" for when the database is opened
mongoose.connection.once('open', function() {
    
   

    var query = Students.find();
    query.exec(function(err, docs) {
        
        var lastNameLength = 1110;
        var shortLastName = 0;
        var minGrade = 0;
        
        
        for(var i=0; i < docs.length; i++)
        {
            
            
            if(docs[i].last.length < lastNameLength){
                
                lastNameLength = docs[i].last.length;
                shortLastName = docs[i].last;
                minGrade = Math.min(docs[i].grades.homework1, docs[i].grades.homework2, 
                docs[i].grades.homework3);
            }   
        }

        console.log("The longest last name is: " +  shortLastName);
        console.log("The students highest grade is: " + minGrade);
        console.log("The students highest grade with 10 points added: " + (minGrade - 10));
        
        
        });
});